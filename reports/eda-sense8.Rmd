---
title: "Dados sobre séries de TV"
output:
  html_notebook:
    toc: yes
    toc_float: yes
  html_document:
    df_print: paged
    toc: yes
    toc_float: yes
---

```{r setup, echo=FALSE, warning=FALSE, message=FALSE}
library(tidyverse)
library(here)
theme_set(theme_bw())
```

Neste laboratório, serão analisados os episódios de três séries de TV: Friends, Desperate Housewives e House.

### Importando os dados

O primeiro passo desta análise é importar os dados a serem utilizados e filtrar as séries de interesse.

```{r}
episodes = read_csv(here("data/series_from_imdb.csv"), 
                    progress = FALSE,
                    col_types = cols(.default = col_double(), 
                                     series_name = col_character(), 
                                     episode = col_character(), 
                                     url = col_character(),
                                     season = col_character())) %>% 
    filter(series_name %in% c("Friends", "Desperate Housewives", "House"))
```

### Respondendo às perguntas:

 * a. Qual das séries é mais bem avaliada no IMDB? A diferença é grande? Pequena? Muda de acordo com as temporadas da série? 
 * b. Qual das séries tem episódios de qualidade mais irregular segundo o IMDB? A diferença é grande? Pequena?

####  1. Qual das séries é mais bem avaliada no IMDB? A diferença é grande? Pequena? Muda de acordo com as temporadas da série? 

  O critério para escolha da série mais bem avaliada foi escolhido de acordo com o valor da mediana, uma medida que significa que a metade das avaliações dos usuários estão abaixo dessa nota e a outra metade está acima.
  
```{r}
episodes %>% group_by(series_name, season) %>% 
  summarise(median_by_serie = median(user_rating)) %>%
  ggplot(aes(x = season, y = median_by_serie, color = series_name, group=series_name)) +
  geom_line(stat='identity') +
  geom_point() +
  labs(x = "Temporadas", y = "Mediana das avaliações")  +
  guides(color=guide_legend("Série"))
```
  
  No gráfico é possível visualizar a relação entre as temporadas das séries e as medianas das avaliações dos usuários no decorrer das temporadas. A série que obteve maior mediana foi a série House, sendo então a mais bem avaliada de acordo com o critério escolhido. Este seriado liderou as demais principalmente durante as 4 primeiras temporadas, onde obteve avaliação crescente e maior pico (4ª temporada, com valor aproximado de 8.7). A partir da 6ª temporada, a mediana das avaliações foi diminuindo consideravelmente, chegando a seu valor mínimo em sua última temporada, com mediana igual a aproximadamente 8.2, sendo este a maior mediana das avaliações do seriado Desperate Housewives, ocupando o terceiro lugar no ranking de votações.
  Se pode observar que a série Friends foi uma boa concorrente e se manteve com nota bem próxima à série House, chegando a liderar nas avaliações nas três últimas temporadas: 8, 9 e 10.
  
####  2. Qual das séries tem episódios de qualidade mais irregular segundo o IMDB? A diferença é grande? Pequena? 

```{r}
episodes %>%
  ggplot(aes(x = series_ep, y = user_rating, color = series_name))  + 
  geom_line() + 
  facet_wrap(~ series_name) +
  labs(x = "Episódios", y = "Avaliação dos usuários")  +
  theme(legend.position = 'None')
```

```{r}
episodes %>% filter(series_name == 'Friends') %>%
  ggplot(aes(x = season_ep, y = user_rating)) +
  geom_line() + 
  labs(x = "Episódios", y = "Avaliação", title = "Friends") +
  facet_wrap(~ season)

episodes %>% filter(series_name == 'House') %>%
  ggplot(aes(x = season_ep, y = user_rating)) +
  geom_line() + 
  labs(x = "Episódios", y = "Avaliação", title = "House") +
  facet_wrap(~ season)

episodes %>% filter(series_name == 'Desperate Housewives') %>%
  ggplot(aes(x = season_ep, y = user_rating)) +
  geom_line() + 
  labs(x = "Episódios", y = "Avaliação", title = "Desperate Housewives") +
  facet_wrap(~ season)
               
```

  O gráfico acima exibe a relação entre o episódio e a avaliação dada pelo usuários em cada uma das três séries. Como a interpretação da variação é difícil no gráfico, optou-se por calcular o coeficiente de variação das avaliações (cv_avaliacao) para cada série:

```{r}
episodes %>% group_by(series_name) %>%
  summarise(media_avaliacao = mean(user_rating, na.rm = T), 
            desv_avaliacao = sd(user_rating, na.rm = T), 
            cv_avaliacao = (desv_avaliacao/media_avaliacao) * 100) %>% 
  ggplot(aes(x = series_name, y = cv_avaliacao))  + 
  geom_point(stat = "identity") +
  labs(x = "Séries", y = "Coeficiente de Variação")
```

  O Coeficiente de Variação serve para medir a dispersão das avaliações no decorrer dos episódios de cada série. Quando esse valor ultrapassa 30%, dizemos que os dados possuem alta dispersão; entre 15% e 30%, dizemos que os dados estão com média dispersão; abaixo disso, os dados estão com baixa dispersão. Todas as séries possuem baixa dispersão, pois os coeficientes de variação estão entre 3.8% e 4.5%. A série que apresenta maior dispersão entre as avaliações dos episódios é House, seguido de Friends e Desperate Housewives.

#### Bônus 1: Qual das séries ou temporadas tem episódios mais sem graça? (Um episódio é sem graça se ninguém nem ama nem odeia ele) 

```{r}
episodes %>% 
    filter(user_rating == min(user_rating))
```


## Distribuição de avaliações por seriado.

```{r}
episodes %>% 
  group_by(series_name) %>%
    ggplot(aes(x = series_name, y = user_rating)) + 
    geom_boxplot(width = .5, outlier.color = NA) +   
    geom_jitter(width = .1, size = 2, alpha = .5, color = "red") +
  labs(x = "Séries", y = "Avaliação no IMDB")
```
  
  Como se pode perceber nos boxplots acima, o seriado Desperate Housewives possui a maior parte de suas avaliações entre 7.5 e 8.2. Também é possível notar que poucos episódios estão acima de nota 9.0. A série de comédia Friends possui a maior parte de suas avaliações entre 8.0 e 9.0, contendo mais episódios acima de 9.0 que as demais séries. House possui mediana próxima a 8.6, o que significa que metade de suas avaliações estão abaixo dessa nota e metade está acima. Pode-se notar também que suas avaliações se concentram entre 8.0 e 9.5.


### Há padrões na avaliação ao longo do tempo?

```{r}
episodes %>% 
  ggplot(aes(x = season_ep, y = user_rating, color = season)) + 
  geom_line() + 
  geom_point() 
```

Correlações

```{r}
episodes %>% 
    group_by(season) %>% 
    summarise(correlacao_linear = cor(season_ep, user_rating, 
                                      method = "pearson"), 
              correlacao_kendall = cor(season_ep, user_rating, 
                                       method = "kendall"))

```

## Qual o episódio mais detestado? 

```{r}
episodes %>% filter (series_name == 'Friends') %>%
    ggplot(aes(x = season_ep, y = r1, color = season)) + 
    geom_line() + 
    scale_x_continuous(breaks = 1:12)
```

### E amado? 

```{r}
episodes %>% filter (series_name == 'Friends') %>%
    ggplot(aes(x = season_ep, y = r10, color = season)) +
    geom_line()# +
    #scale_x_continuous(breaks = 1:12)
```

### Amor e ódio andam juntos?

Quais são episódios que estão entre os mais amados e mais odiados? 

```{r}
episodes =  episodes %>%
    mutate(
        rank_odiados = row_number(r1), # maior = mais odiado
        rank_amados = row_number(r10), # maior = mais amado
        amado_odiado = rank_amados * rank_odiados) # maior = mais amado E odiado
    
episodes %>%
    ggplot(aes(
        x = r1,
        y = r10,
        color = season,
        size = amado_odiado,
        label = season_ep
    )) +
    geom_point(alpha = .7) +
    geom_text(nudge_x = .001, nudge_y = -.01) 
```

```{r}
episodes %>% 
    arrange(-amado_odiado)
```

